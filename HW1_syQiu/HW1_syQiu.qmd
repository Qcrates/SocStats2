---
title: "SOCIOL723 Week1"
author: "Shuyi Qiu"
format: html
editor: visual
embed-resources: true
mainfont: Optima
highlight-style: github
---

# 1.1 Causal Inference Terms

1.  **Estimand**: the target quantity.
    -   Theoretical estimand

        -   A unit-specific quantity: this can be realized outcome, potential outcome, or a difference in potential outcome

        -   The target population: over whom or what to aggregate the unit-specific quantity

    -   Empirical estimand: observable quantities
2.  **Causal interaction:** The intervention to two variables over one population
3.  **Effect heterogeneity**: Intervention to one variable averaged over two populations
4.  **Moderation:**
5.  **Collider**: The paper does not give an exact definition but it seems to be a variable that will cause misleading conclusion if controlled on.

# 1.2 Set-up

```{r}
#| error: false
#| warning: false

set.seed(27705)
library(tidyverse)
library(gt)
library(pwr)
```

# 1.3 ATE

```{r}
d <- data.frame(
  T = c(0, 0, 1, 0, 0, 1, 1, 1),
  Y0 = c(5, 8, 5, 12, 4, 8, 4, 9),
  Y1 = c(5, 10, 3, 13, 2, 9, 1, 13), 
  id = LETTERS[1:8]
)
gt(d, rowname_col = "id")
```

Create the `Y` variable and calculate the ATE

```{r}
d <- d |> 
  mutate(Y = ifelse(T == 0, Y0, Y1))
mean(d$Y[d$T == 1]) - mean(d$Y[d$T == 0])
```

$ATE = -0.75$

# 1.4 Multiple try

A new sample of $T$

```{r}
new_T <- sample(d$T)
mean(d$Y[new_T == 1]) - mean(d$Y[new_T == 0])
```

Try this for more times:

```{r}
iter_num <- 100

df_ate <- data.frame(
  try_no = c(1:iter_num)
)

for (i in c(1:iter_num)){
  new_T <- sample(d$T)
  df_ate[i,c("ate")] <- mean(d$Y[new_T == 1]) - mean(d$Y[new_T == 0])
}

head(df_ate)

range(df_ate$ate)
mean(df_ate$ate)

# Real ATE
mean(d$Y1-d$Y0)
```

None of the estimates in the above table equals to the real ATE.

# 1.5 Power analysis

To have a general idea of how large the experiment sample should be to have statistical power, we can do a power analysis:

```{r}
cohen_d <- 0.125/sd(d$Y)

# The current power
pwr.t.test(d = cohen_d,
           sig.level = 0.05,
           n = 8,
           type = "paired",
           alternative = "two.sided")

# What if we want to have a power of 0.8?
pwr.t.test(d = cohen_d,
           sig.level = 0.05,
           power = 0.8,
           type = "paired",
           alternative = "two.sided")
```

The power with 8 experiment samples is only around 0.05. If we want to have a power of 0.8, at least 9394 people should be recruited into the experiment.
